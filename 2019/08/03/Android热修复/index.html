<html>
<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">

  
  <title>
    Androidçƒ­ä¿®å¤ |
    å²è¾°é¾™
  </title>
  


  <meta name="description" content>
  <meta name="author" content="John Doe">
  <meta property="og:title" content="Androidçƒ­ä¿®å¤">
  <meta property="og:description" content>
  <meta property="og:site_name" content="å²è¾°é¾™">
  <meta property="og:image" content="http://yoursite.com/img/default3.jpg">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:description" content>
  <meta name="twitter:title" content="Androidçƒ­ä¿®å¤">

  <meta name="twitter:image" content="http://yoursite.com/img/default.jpg">

  <script src="https://www.amcharts.com/lib/4/core.js"></script>
  <script src="https://www.amcharts.com/lib/4/charts.js"></script>
  <script src="https://www.amcharts.com/lib/4/themes/animated.js"></script>

  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">
  <link rel="stylesheet" href="/./css/style.css">

</head>

<body>
    <!-- Menu -->
    <nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark page-navbar gradient">
  <div class="container">
    <a class="navbar-brand logo" href="http://yoursite.com">
      å²è¾°é¾™</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav"
      aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav mx-auto">
        <li class="nav-item item">
          
        <li class="nav-item item">
          <a class="nav-link" href="/">
            Home</a>
        </li>
        
        <li class="nav-item item">
          <a class="nav-link" href="/archives">
            ğŸ—‚ï¸Archives</a>
        </li>
        
        <li class="nav-item item">
          <a class="nav-link" href="https://hexo.io/">
            Hexo</a>
        </li>
        
        </li>
      </ul>
    </div>
  </div>
</nav>

    <main class="page main-page">
        <div class="container blogPost">
    <div class="row">
        <div class="col-sm-8">
            <h2 class="blog-post-title">
                Androidçƒ­ä¿®å¤
            </h2>
            <p class="meta"><i class="far fa-clock"></i>
                2019-08-03
                
            </p>
            <!-- Content -->
            <p><img src="2019-08-03-11-53-40.png" alt></p>
<p><strong>ç±»å¦‚ä½•åŠ è½½ï¼Ÿ</strong></p>
<p>javaä¸­æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ClassLoaderè¿›è¡Œç±»çš„åŠ è½½ã€‚<br>android ä¸­ æˆ‘ä»¬éƒ½çŸ¥é“æœ€åçš„ä»£ç æ–‡ä»¶éƒ½ä¼šè¢«æ‰“åŒ…æˆdexæ ¼å¼çš„æ–‡ä»¶ï¼›classæ–‡ä»¶åŒ…å«åœ¨dexæ–‡ä»¶ä¸­ã€‚<br>åŠ è½½dexä¸­classæ–‡ä»¶æˆ‘ä»¬éœ€è¦ä½¿ç”¨DexClassLoaderæˆ–è€…PathClassLoaderã€‚</p>
<p><strong>ç±»åŠ è½½å™¨</strong></p>
<p>PathClassLoaderå¯ä»¥åŠ è½½Androidç³»ç»Ÿä¸­çš„dexæ–‡ä»¶<br>DexClassLoaderå¯ä»¥åŠ è½½ä»»æ„ç›®å½•çš„dex/zip/apk/jaræ–‡ä»¶ , ä½†æ˜¯è¦æŒ‡å®šoptimizedDirectory.<br>è¿™ä¸¤ä¸ªç±»åŠ è½½å™¨éƒ½ç»§æ‰¿BaseDexClassLoader, å¹¶ä¸”åœ¨æ„é€ å‡½æ•°ä¸­, DexClassLoaderå¤šä¼ å…¥äº†ä¸€ä¸ªoptimizedDirectoryã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹ BaseDexClassLoader</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class BaseDexClassLoader extends ClassLoader &#123;</span><br><span class="line">    private final DexPathList pathList;</span><br><span class="line">    public BaseDexClassLoader(String dexPath, File optimizedDirectory, String libraryPath, ClassLoader parent)&#123;</span><br><span class="line">        super(parent);</span><br><span class="line">        this.pathList = new DexPathList(this, dexPath, libraryPath, optimizedDirectory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ„é€ æ–¹æ³•ä¸­åˆå§‹åŒ–äº†pathList, ä¼ å…¥ä¸‰ä¸ªå‚æ•° , åˆ†åˆ«ä¸º<br>dexPathï¼šç›®æ ‡æ–‡ä»¶è·¯å¾„ï¼ˆä¸€èˆ¬æ˜¯dexæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯jar/apk/zipæ–‡ä»¶ï¼‰æ‰€åœ¨ç›®å½•ã€‚çƒ­ä¿®å¤æ—¶ç”¨æ¥æŒ‡å®šæ–°çš„dex<br>optimizedDirectoryï¼šdexæ–‡ä»¶çš„è¾“å‡ºç›®å½•ï¼ˆå› ä¸ºåœ¨åŠ è½½jar/apk/zipç­‰å‹ç¼©æ ¼å¼çš„ç¨‹åºæ–‡ä»¶æ—¶ä¼šè§£å‹å‡ºå…¶ä¸­çš„dexæ–‡ä»¶ï¼Œè¯¥ç›®å½•å°±æ˜¯ä¸“é—¨ç”¨äºå­˜æ”¾è¿™äº›è¢«è§£å‹å‡ºæ¥çš„dexæ–‡ä»¶çš„ï¼‰ã€‚<br>libraryPathï¼šåŠ è½½ç¨‹åºæ–‡ä»¶æ—¶éœ€è¦ç”¨åˆ°çš„åº“è·¯å¾„ã€‚<br>parentï¼šçˆ¶åŠ è½½å™¨</p>
<p><strong>ç±»çš„åŠ è½½è¿‡ç¨‹</strong><br>å¦‚ä¸‹æ–¹æ³•ç”¨äºåŠ è½½dexä¸­çš„classæ–‡ä»¶ï¼Œ æ‹¿åˆ°åˆå§‹åŒ–å®Œæˆçš„ pathList ä¹‹å , æ ¹æ®ç±»åæ‰¾å‡ºç›¸åº”çš„classå­—èŠ‚ç æ–‡ä»¶, å¦‚æœæ²¡æœ‰å¼‚å¸¸ç›´æ¥è¿”å›class.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Overrideprotected Class&lt;?&gt; findClass(String name) throws ClassNotFoundException &#123;</span><br><span class="line">    List&lt;Throwable&gt; suppressedExceptions = new ArrayList&lt;Throwable&gt;();</span><br><span class="line">    //ä»pathListä¸­æ‰¾åˆ°ç›¸åº”ç±»åçš„classæ–‡ä»¶</span><br><span class="line">    Class c = pathList.findClass(name, suppressedExceptions);</span><br><span class="line">    //åˆ¤ç©º, æŠ›å‡ºå¼‚å¸¸</span><br><span class="line">    if (c == null) &#123;</span><br><span class="line">        ClassNotFoundException cnfe = new ClassNotFoundException(&quot;Didn&apos;t find class \&quot;&quot; + name + &quot;\&quot; on path: &quot; + pathList);</span><br><span class="line">        for (Throwable t : suppressedExceptions) &#123;</span><br><span class="line">            cnfe.addSuppressed(t);</span><br><span class="line">        &#125;</span><br><span class="line">        throw cnfe;</span><br><span class="line">    &#125;</span><br><span class="line">    return c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>DexPathList</strong></p>
<p>æ„é€ å‡½æ•°. æˆ‘ä»¬åœ¨BaseDexClassLoaderä¸­å®ä¾‹åŒ–DexPathListéœ€è¦ç”¨åˆ°<br>findClassæ–¹æ³•, åœ¨BaseDexClassLoaderçš„findClassä¸­, æœ¬è´¨è°ƒç”¨äº†DexpathListçš„fndClassæ–¹æ³•</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public DexPathList(ClassLoader definingContext, String dexPath,</span><br><span class="line">        String libraryPath, File optimizedDirectory) &#123;</span><br><span class="line">     this.definingContext = definingContext;</span><br><span class="line">     ArrayList&lt;IOException&gt; suppressedExceptions = new ArrayList&lt;IOException&gt;();</span><br><span class="line">     // save dexPath for BaseDexClassLoader</span><br><span class="line">     this.dexElements = makePathElements(splitDexPath(dexPath), optimizedDirectory,</span><br><span class="line">                                         suppressedExceptions);</span><br><span class="line">     </span><br><span class="line">     this.nativeLibraryDirectories = splitPaths(libraryPath, false);</span><br><span class="line">     this.systemNativeLibraryDirectories =</span><br><span class="line">             splitPaths(System.getProperty(&quot;java.library.path&quot;), true);</span><br><span class="line">     List&lt;File&gt; allNativeLibraryDirectories = new ArrayList&lt;&gt;(nativeLibraryDirectories);</span><br><span class="line">     allNativeLibraryDirectories.addAll(systemNativeLibraryDirectories);</span><br><span class="line">     this.nativeLibraryPathElements = makePathElements(allNativeLibraryDirectories, null,</span><br><span class="line">                                                       suppressedExceptions);</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å°†ä¼ å…¥çš„classLoaderä¿å­˜èµ·æ¥ , æ¥ä¸‹æ¥ä½¿ç”¨makePathElementsæ–¹æ³• ,æ¥åˆå§‹åŒ–Elementæ•°ç»„</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">private static Element[] makeDexElements(ArrayList&lt;File&gt; files, File optimizedDirectory, ArrayList&lt;IOException&gt; suppressedExceptions) &#123;</span><br><span class="line">    // 1.åˆ›å»ºElementé›†åˆ</span><br><span class="line">    ArrayList&lt;Element&gt; elements = new ArrayList&lt;Element&gt;();</span><br><span class="line">    // 2.éå†æ‰€æœ‰dexæ–‡ä»¶ï¼ˆä¹Ÿå¯èƒ½æ˜¯jarã€apkæˆ–zipæ–‡ä»¶ï¼‰</span><br><span class="line">    for (File file : files) &#123;</span><br><span class="line">        ZipFile zip = null;</span><br><span class="line">        DexFile dex = null;</span><br><span class="line">        String name = file.getName();</span><br><span class="line">        ...</span><br><span class="line">        // å¦‚æœæ˜¯dexæ–‡ä»¶</span><br><span class="line">        if (name.endsWith(DEX_SUFFIX)) &#123;</span><br><span class="line">            dex = loadDexFile(file, optimizedDirectory);</span><br><span class="line">        // å¦‚æœæ˜¯apkã€jarã€zipæ–‡ä»¶ï¼ˆè¿™éƒ¨åˆ†åœ¨ä¸åŒçš„Androidç‰ˆæœ¬ä¸­ï¼Œå¤„ç†æ–¹å¼æœ‰ç»†å¾®å·®åˆ«ï¼‰</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            zip = file;</span><br><span class="line">            dex = loadDexFile(file, optimizedDirectory);</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">        // 3.å°†dexæ–‡ä»¶æˆ–å‹ç¼©æ–‡ä»¶åŒ…è£…æˆElementå¯¹è±¡ï¼Œå¹¶æ·»åŠ åˆ°Elementé›†åˆä¸­</span><br><span class="line">        if ((zip != null) || (dex != null)) &#123;</span><br><span class="line">            elements.add(new Element(file, false, zip, dex));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // 4.å°†Elementé›†åˆè½¬æˆElementæ•°ç»„è¿”å›</span><br><span class="line">    return elements.toArray(new Element[elements.size()]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>DexPathListçš„æ„é€ å‡½æ•°æ˜¯å°†ä¸€ä¸ªä¸ªçš„ç›®æ ‡ï¼ˆå¯èƒ½æ˜¯dexã€apkã€jarã€zip , è¿™äº›ç±»å‹åœ¨ä¸€å¼€å§‹æ—¶å°±å®šä¹‰å¥½äº†ï¼‰å°è£…æˆä¸€ä¸ªä¸ªElementå¯¹è±¡ï¼Œæœ€åæ·»åŠ åˆ°Elementé›†åˆä¸­ã€‚</p>
<p>Androidçš„ç±»åŠ è½½å™¨ï¼ˆä¸ç®¡æ˜¯PathClassLoaderï¼Œè¿˜æ˜¯DexClassLoaderï¼‰ï¼Œå®ƒä»¬æœ€ååªè®¤dexæ–‡ä»¶ï¼Œè€ŒloadDexFile()æ˜¯åŠ è½½dexæ–‡ä»¶çš„æ ¸å¿ƒæ–¹æ³•ï¼Œå¯ä»¥ä»jarã€apkã€zipä¸­æå–å‡ºdex</p>
<p><strong>findClass æ–¹æ³•</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public Class findClass(String name, List&lt;Throwable&gt; suppressed) &#123;</span><br><span class="line">    for (Element element : dexElements) &#123;</span><br><span class="line">        DexFile dex = element.dexFile;</span><br><span class="line">        if (dex != null) &#123;</span><br><span class="line">            Class clazz = dex.loadClassBinaryName(name, definingContext, suppressed);</span><br><span class="line">            if (clazz != null) &#123;</span><br><span class="line">                return clazz;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    if (dexElementsSuppressedExceptions != null) &#123;</span><br><span class="line">        suppressed.addAll(Arrays.asList(dexElementsSuppressedExceptions));</span><br><span class="line">    &#125;</span><br><span class="line">    return null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨DexPathListçš„æ„é€ å‡½æ•°ä¸­å·²ç»åˆå§‹åŒ–äº†dexElementsï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•å°±å¾ˆå¥½ç†è§£äº†ï¼Œåªæ˜¯å¯¹Elementæ•°ç»„è¿›è¡Œéå†ï¼Œä¸€æ—¦æ‰¾åˆ°ç±»åä¸nameç›¸åŒçš„ç±»æ—¶ï¼Œå°±ç›´æ¥è¿”å›è¿™ä¸ªclassï¼Œæ‰¾ä¸åˆ°åˆ™è¿”å›nullã€‚</p>
<p><strong>çƒ­ä¿®å¤çš„å®ç°æ–¹æ³•</strong><br>åŠ è½½classä¼šä½¿ç”¨BaseDexClassLoaderï¼Œåœ¨åŠ è½½æ—¶ï¼Œä¼šéå†æ–‡ä»¶ä¸‹çš„elementï¼Œå¹¶ä»elementä¸­è·å–dexæ–‡ä»¶</p>
<p>classæ–‡ä»¶åœ¨dexé‡Œé¢ , æ‰¾åˆ°dexçš„æ–¹æ³•æ˜¯éå†æ•°ç»„ , é‚£ä¹ˆçƒ­ä¿®å¤çš„åŸç†, å°±æ˜¯å°†æ”¹å¥½bugçš„dexæ–‡ä»¶æ”¾è¿›é›†åˆçš„å¤´éƒ¨, è¿™æ ·éå†æ—¶ä¼šé¦–å…ˆéå†ä¿®å¤å¥½çš„dexå¹¶æ‰¾åˆ°ä¿®å¤å¥½çš„ç±»ã€‚</p>
<p><strong>ä¸€ä¸ªDemoæ¼”ç¤ºçƒ­ä¿®å¤çš„åº”ç”¨ï¼ˆä»£ç ä¿®å¤ï¼‰</strong></p>
<p>å»ºç«‹TestClass ç±»æ–‡ä»¶<br>å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">package com.baweigame.hotupdateapplication;</span><br><span class="line">public class TestClass &#123;</span><br><span class="line">    public int Debug()&#123;</span><br><span class="line">        return 10/0;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é™¤0ä¼šæŠ¥å¼‚å¸¸ã€‚è¿™ä¸ªç±»å³æˆ‘ä»¬éœ€è¦çƒ­æ›´æ–°ä¿®å¤çš„ç±»ã€‚</p>
<p>åœ¨MainActivityä¸­è°ƒç”¨å¦‚ä¸‹ï¼š</p>
<p><img src="2019-08-03-11-56-17.png" alt></p>
<p>å³ç‚¹å‡» æŒ‰é’® å°†å‘ç”Ÿé”™è¯¯ã€‚</p>
<p><strong>ä¸‹é¢æ˜¯çƒ­ä¿®å¤æ ¸å¿ƒå·¥å…·ç±»ï¼šFixDexUtil</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line">package com.baweigame.hotupdateapplication;</span><br><span class="line">import android.content.Context;</span><br><span class="line">import android.os.Environment;</span><br><span class="line">import android.support.annotation.NonNull;</span><br><span class="line">import android.widget.Toast;</span><br><span class="line">import java.io.File;</span><br><span class="line">import java.lang.reflect.Array;</span><br><span class="line">import java.lang.reflect.Field;</span><br><span class="line">import java.util.HashSet;</span><br><span class="line">import dalvik.system.DexClassLoader;</span><br><span class="line">import dalvik.system.PathClassLoader;</span><br><span class="line">public class FixDexUtil &#123;</span><br><span class="line">    private static final String DEX_SUFFIX = &quot;.dex&quot;;</span><br><span class="line">    private static final String APK_SUFFIX = &quot;.apk&quot;;</span><br><span class="line">    private static final String JAR_SUFFIX = &quot;.jar&quot;;</span><br><span class="line">    private static final String ZIP_SUFFIX = &quot;.zip&quot;;</span><br><span class="line">    public static final String DEX_DIR = &quot;odex&quot;;</span><br><span class="line">    private static final String OPTIMIZE_DEX_DIR = &quot;optimize_dex&quot;;</span><br><span class="line">    private static HashSet&lt;File&gt; loadedDex = new HashSet&lt;&gt;();</span><br><span class="line">    static &#123;</span><br><span class="line">        loadedDex.clear();</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * åŠ è½½è¡¥ä¸ï¼Œä½¿ç”¨é»˜è®¤ç›®å½•ï¼šdata/data/åŒ…å/files/odex</span><br><span class="line">     *</span><br><span class="line">     * @param context</span><br><span class="line">     */</span><br><span class="line">    public static void loadFixedDex(Context context) &#123;</span><br><span class="line">        loadFixedDex(context, null);</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * åŠ è½½è¡¥ä¸</span><br><span class="line">     *</span><br><span class="line">     * @param context       ä¸Šä¸‹æ–‡</span><br><span class="line">     * @param patchFilesDir è¡¥ä¸æ‰€åœ¨ç›®å½•</span><br><span class="line">     */</span><br><span class="line">    public static void loadFixedDex(Context context, File patchFilesDir) &#123;</span><br><span class="line">        // dexåˆå¹¶ä¹‹å‰çš„dex</span><br><span class="line">        doDexInject(context, loadedDex);</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * éªŒè¯æ˜¯å¦éœ€è¦çƒ­ä¿®å¤</span><br><span class="line">     */</span><br><span class="line">    public static boolean isGoingToFix(@NonNull Context context) &#123;</span><br><span class="line">        boolean canFix = false;</span><br><span class="line">        File externalStorageDirectory = null;//Environment.getExternalStorageDirectory();</span><br><span class="line">        // éå†æ‰€æœ‰çš„ä¿®å¤dex , å› ä¸ºå¯èƒ½æ˜¯å¤šä¸ªdexä¿®å¤åŒ…</span><br><span class="line">        File fileDir = externalStorageDirectory != null ?</span><br><span class="line">                externalStorageDirectory :</span><br><span class="line">                new File(context.getFilesDir(), DEX_DIR);// data/data/åŒ…å/files/odexï¼ˆè¿™ä¸ªå¯ä»¥ä»»æ„ä½ç½®ï¼‰</span><br><span class="line">        File[] listFiles = fileDir.listFiles();</span><br><span class="line">        if (listFiles==null)&#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        for (File file : listFiles) &#123;</span><br><span class="line">            if (file.getName().startsWith(&quot;classes&quot;) &amp;&amp;</span><br><span class="line">                    (file.getName().endsWith(DEX_SUFFIX)</span><br><span class="line">                            || file.getName().endsWith(APK_SUFFIX)</span><br><span class="line">                            || file.getName().endsWith(JAR_SUFFIX)</span><br><span class="line">                            || file.getName().endsWith(ZIP_SUFFIX))) &#123;</span><br><span class="line">                loadedDex.add(file);// å­˜å…¥é›†åˆ</span><br><span class="line">                //æœ‰ç›®æ ‡dexæ–‡ä»¶, éœ€è¦ä¿®å¤</span><br><span class="line">                canFix = true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return canFix;</span><br><span class="line">    &#125;</span><br><span class="line">    private static void doDexInject(Context appContext, HashSet&lt;File&gt; loadedDex) &#123;</span><br><span class="line">        String optimizeDir = appContext.getFilesDir().getAbsolutePath() +</span><br><span class="line">                File.separator + OPTIMIZE_DEX_DIR;</span><br><span class="line">        // data/data/åŒ…å/files/optimize_dexï¼ˆè¿™ä¸ªå¿…é¡»æ˜¯è‡ªå·±ç¨‹åºä¸‹çš„ç›®å½•ï¼‰</span><br><span class="line">        File fopt = new File(optimizeDir);</span><br><span class="line">        if (!fopt.exists()) &#123;</span><br><span class="line">            fopt.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        try &#123;</span><br><span class="line">            // 1.åŠ è½½åº”ç”¨ç¨‹åºdexçš„Loader</span><br><span class="line">            PathClassLoader pathLoader = (PathClassLoader) appContext.getClassLoader();</span><br><span class="line">            for (File dex : loadedDex) &#123;</span><br><span class="line">                // 2.åŠ è½½æŒ‡å®šçš„ä¿®å¤çš„dexæ–‡ä»¶çš„Loader</span><br><span class="line">                DexClassLoader dexLoader = new DexClassLoader(</span><br><span class="line">                        dex.getAbsolutePath(),// ä¿®å¤å¥½çš„dexï¼ˆè¡¥ä¸ï¼‰æ‰€åœ¨ç›®å½•</span><br><span class="line">                        fopt.getAbsolutePath(),// å­˜æ”¾dexçš„è§£å‹ç›®å½•ï¼ˆç”¨äºjarã€zipã€apkæ ¼å¼çš„è¡¥ä¸ï¼‰</span><br><span class="line">                        null,// åŠ è½½dexæ—¶éœ€è¦çš„åº“</span><br><span class="line">                        pathLoader// çˆ¶ç±»åŠ è½½å™¨</span><br><span class="line">                );</span><br><span class="line">                // 3.å¼€å§‹åˆå¹¶</span><br><span class="line">                // åˆå¹¶çš„ç›®æ ‡æ˜¯Element[],é‡æ–°èµ‹å€¼å®ƒçš„å€¼å³å¯</span><br><span class="line">                /**</span><br><span class="line">                 * BaseDexClassLoaderä¸­æœ‰ å˜é‡: DexPathList pathList</span><br><span class="line">                 * DexPathListä¸­æœ‰ å˜é‡ Element[] dexElements</span><br><span class="line">                 * ä¾æ¬¡åå°„å³å¯</span><br><span class="line">                 */</span><br><span class="line">                //3.1 å‡†å¤‡å¥½pathListçš„å¼•ç”¨</span><br><span class="line">                Object dexPathList = getPathList(dexLoader);</span><br><span class="line">                Object pathPathList = getPathList(pathLoader);</span><br><span class="line">                //3.2 ä»pathListä¸­åå°„å‡ºelementé›†åˆ</span><br><span class="line">                Object leftDexElements = getDexElements(dexPathList);</span><br><span class="line">                Object rightDexElements = getDexElements(pathPathList);</span><br><span class="line">                //3.3 åˆå¹¶ä¸¤ä¸ªdexæ•°ç»„</span><br><span class="line">                Object dexElements = combineArray(leftDexElements, rightDexElements);</span><br><span class="line">                // é‡å†™ç»™PathListé‡Œé¢çš„Element[] dexElements;èµ‹å€¼</span><br><span class="line">                Object pathList = getPathList(pathLoader);// ä¸€å®šè¦é‡æ–°è·å–ï¼Œä¸è¦ç”¨pathPathListï¼Œä¼šæŠ¥é”™</span><br><span class="line">                setField(pathList, pathList.getClass(), &quot;dexElements&quot;, dexElements);</span><br><span class="line">            &#125;</span><br><span class="line">            Toast.makeText(appContext, &quot;ä¿®å¤å®Œæˆ&quot;, Toast.LENGTH_SHORT).show();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * åå°„ç»™å¯¹è±¡ä¸­çš„å±æ€§é‡æ–°èµ‹å€¼</span><br><span class="line">     */</span><br><span class="line">    private static void setField(Object obj, Class&lt;?&gt; cl, String field, Object value) throws NoSuchFieldException, IllegalAccessException &#123;</span><br><span class="line">        Field declaredField = cl.getDeclaredField(field);</span><br><span class="line">        declaredField.setAccessible(true);</span><br><span class="line">        declaredField.set(obj, value);</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * åå°„å¾—åˆ°å¯¹è±¡ä¸­çš„å±æ€§å€¼</span><br><span class="line">     */</span><br><span class="line">    private static Object getField(Object obj, Class&lt;?&gt; cl, String field) throws NoSuchFieldException, IllegalAccessException &#123;</span><br><span class="line">        Field localField = cl.getDeclaredField(field);</span><br><span class="line">        localField.setAccessible(true);</span><br><span class="line">        return localField.get(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * åå°„å¾—åˆ°ç±»åŠ è½½å™¨ä¸­çš„pathListå¯¹è±¡</span><br><span class="line">     */</span><br><span class="line">    private static Object getPathList(Object baseDexClassLoader) throws ClassNotFoundException, NoSuchFieldException, IllegalAccessException &#123;</span><br><span class="line">        return getField(baseDexClassLoader, Class.forName(&quot;dalvik.system.BaseDexClassLoader&quot;), &quot;pathList&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * åå°„å¾—åˆ°pathListä¸­çš„dexElements</span><br><span class="line">     */</span><br><span class="line">    private static Object getDexElements(Object pathList) throws NoSuchFieldException, IllegalAccessException &#123;</span><br><span class="line">        return getField(pathList, pathList.getClass(), &quot;dexElements&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * æ•°ç»„åˆå¹¶ </span><br><span class="line">     */</span><br><span class="line">    private static Object combineArray(Object arrayLhs, Object arrayRhs) &#123;</span><br><span class="line">        Class&lt;?&gt; clazz = arrayLhs.getClass().getComponentType();</span><br><span class="line">        int i = Array.getLength(arrayLhs);// å¾—åˆ°å·¦æ•°ç»„é•¿åº¦ï¼ˆè¡¥ä¸æ•°ç»„ï¼‰</span><br><span class="line">        int j = Array.getLength(arrayRhs);// å¾—åˆ°åŸdexæ•°ç»„é•¿åº¦</span><br><span class="line">        int k = i + j;// å¾—åˆ°æ€»æ•°ç»„é•¿åº¦ï¼ˆè¡¥ä¸æ•°ç»„+åŸdexæ•°ç»„ï¼‰</span><br><span class="line">        Object result = Array.newInstance(clazz, k);// åˆ›å»ºä¸€ä¸ªç±»å‹ä¸ºclazzï¼Œé•¿åº¦ä¸ºkçš„æ–°æ•°ç»„</span><br><span class="line">        System.arraycopy(arrayLhs, 0, result, 0, i);</span><br><span class="line">        System.arraycopy(arrayRhs, 0, result, i, j);</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨MainActivityä¸­è°ƒç”¨ï¼Œå¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (FixDexUtil.isGoingToFix(mContext)) &#123;</span><br><span class="line">    FixDexUtil.loadFixedDex(mContext, Environment.getExternalStorageDirectory());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç”Ÿæˆdexæ–‡ä»¶ç”¨äºæ–°ç‰ˆæœ¬ä¿®å¤æ—§ç‰ˆæœ¬bugï¼š</p>
<p>ä¿®æ”¹TestClass,å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">package com.baweigame.hotupdateapplication;</span><br><span class="line">public class TestClass &#123;</span><br><span class="line">    public int Debug()&#123;</span><br><span class="line">        return 10/2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>rebuild project</p>
<p>æ‰¾åˆ°classæ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="2019-08-03-11-56-59.png" alt></p>
<p>å°†TestClass.class æ–‡ä»¶æ‹·è´å‡ºæ¥ï¼Œæ³¨æ„ï¼šæ‹·è´çš„å­˜æ”¾è·¯å¾„è¦ä¸å·¥ç¨‹åŒ…åç›®å½•ä¸€è‡´ï¼Œå¦‚ï¼š</p>
<p><img src="2019-08-03-11-57-10.png" alt></p>
<p>æ‰¾åˆ°dx.bat å¹¶å°†ç›®å½•é…ç½®åˆ°ç¯å¢ƒå˜é‡ä¸­ã€‚</p>
<p>dx.batç›®å½• å¦‚ï¼š C:\Users\zhangyue\AppData\Local\Android\Sdk\build-tools\28.0.3</p>
<p>ç¼–è¯‘dexåŒ…å‘½ä»¤</p>
<p>dx â€“dex â€“output c:\Users\zhangyue\Desktop\classes.dex C:\Users\zhangyue\Desktop\dex</p>
<p>ç”Ÿæˆçš„classes.dex å³å‡çº§ä¿®å¤çš„æ–°ç‰ˆæœ¬dexæ–‡ä»¶ã€‚</p>
<p>å°†dexæ–‡ä»¶pushåˆ° /data/data/åŒ…å/files/odex ç›®å½•ä¸‹ï¼Œè¿è¡Œç¨‹åºæŸ¥çœ‹ä¿®å¤ç»“æœã€‚</p>
<hr>
<hr>
<hr>
<p><strong>åŒäº²å§”æ´¾æœºåˆ¶</strong></p>
<p><img src="2019-08-03-11-57-38.png" alt></p>
<p>1.BootStrapClassLoaderï¼šå¯åŠ¨ç±»åŠ è½½å™¨ï¼Œè¯¥ClassLoaderæ˜¯jvmåœ¨å¯åŠ¨æ—¶åˆ›å»ºçš„ï¼Œç”¨äºåŠ è½½ $JAVA_HOME/jre/libä¸‹é¢çš„ç±»åº“ï¼ˆæˆ–è€…é€šè¿‡å‚æ•°-XbootclasspathæŒ‡å®šï¼‰ã€‚ç”±äºå¼•å¯¼ç±»åŠ è½½å™¨æ¶‰åŠåˆ°è™šæ‹Ÿæœºæœ¬åœ°å®ç°ç»†èŠ‚ï¼Œå¼€å‘è€…æ— æ³•ç›´æ¥è·å–åˆ°å¯åŠ¨ç±»åŠ è½½å™¨çš„å¼•ç”¨ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥é€šè¿‡å¼•ç”¨è¿›è¡Œæ“ä½œã€‚<br>2.ExtClassLoaderï¼šæ‰©å±•ç±»åŠ è½½å™¨ï¼Œè¯¥ClassLoaderæ˜¯åœ¨sun.misc.Launcheré‡Œä½œä¸ºä¸€ä¸ªå†…éƒ¨ç±»ExtClassLoaderå®šä¹‰çš„ï¼ˆå³ sun.misc.Launcher$ExtClassLoaderï¼‰ï¼ŒExtClassLoaderä¼šåŠ è½½ $JAVA_HOME/jre/lib/extä¸‹çš„ç±»åº“ï¼ˆæˆ–è€…é€šè¿‡å‚æ•°-Djava.ext.dirsæŒ‡å®šï¼‰ã€‚<br>3.AppClassLoaderï¼šåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼Œè¯¥ClassLoaderåŒæ ·æ˜¯åœ¨sun.misc.Launcheré‡Œä½œä¸ºä¸€ä¸ªå†…éƒ¨ç±»AppClassLoaderå®šä¹‰çš„ï¼ˆå³ sun.misc.Launcher$AppClassLoaderï¼‰ï¼ŒAppClassLoaderä¼šåŠ è½½javaç¯å¢ƒå˜é‡CLASSPATHæ‰€æŒ‡å®šçš„è·¯å¾„ä¸‹çš„ç±»åº“ï¼Œè€ŒCLASSPATHæ‰€æŒ‡å®šçš„è·¯å¾„å¯ä»¥é€šè¿‡System.getProperty(â€œjava.class.pathâ€)è·å–ï¼›å½“ç„¶ï¼Œè¯¥å˜é‡ä¹Ÿå¯ä»¥è¦†ç›–ï¼Œå¯ä»¥ä½¿ç”¨å‚æ•°-cpï¼Œä¾‹å¦‚ï¼šjava -cp è·¯å¾„ ï¼ˆå¯ä»¥æŒ‡å®šè¦æ‰§è¡Œçš„classç›®å½•ï¼‰ã€‚<br>4.CustomClassLoaderï¼šè‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œè¯¥ClassLoaderæ˜¯æŒ‡æˆ‘ä»¬è‡ªå®šä¹‰çš„ClassLoaderï¼Œæ¯”å¦‚tomcatçš„StandardClassLoaderå±äºè¿™ä¸€ç±»ï¼›å½“ç„¶ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ä½¿ç”¨AppClassLoaderå°±è¶³å¤Ÿäº†ã€‚</p>
<p>ClassLoaderçš„åŒäº²å§”æ´¾æœºåˆ¶æ˜¯è¿™æ ·çš„ï¼ˆè¿™é‡Œå…ˆå¿½ç•¥æ‰è‡ªå®šä¹‰ç±»åŠ è½½å™¨CustomClassLoaderï¼š</p>
<p>1.å½“AppClassLoaderåŠ è½½ä¸€ä¸ªclassæ—¶ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠç±»åŠ è½½è¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨ExtClassLoaderå»å®Œæˆã€‚<br>2.å½“ExtClassLoaderåŠ è½½ä¸€ä¸ªclassæ—¶ï¼Œå®ƒé¦–å…ˆä¹Ÿä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠç±»åŠ è½½è¯·æ±‚å§”æ´¾ç»™BootStrapClassLoaderå»å®Œæˆã€‚<br>3.å¦‚æœBootStrapClassLoaderåŠ è½½å¤±è´¥ï¼ˆä¾‹å¦‚åœ¨$JAVA_HOME/jre/libé‡ŒæœªæŸ¥æ‰¾åˆ°è¯¥classï¼‰ï¼Œä¼šä½¿ç”¨ExtClassLoaderæ¥å°è¯•åŠ è½½ï¼›<br>4.è‹¥ExtClassLoaderä¹ŸåŠ è½½å¤±è´¥ï¼Œåˆ™ä¼šä½¿ç”¨AppClassLoaderæ¥åŠ è½½ï¼Œå¦‚æœAppClassLoaderä¹ŸåŠ è½½å¤±è´¥ï¼Œåˆ™ä¼šæŠ¥å‡ºå¼‚å¸¸ClassNotFoundExceptionã€‚</p>

            <br />
            <p class="meta">
                

<a href="/tags/Android/"> <i class="fas fa-tags"></i>
    Android </a>

            </p>
        </div>

        <div class="col-sm-4">
            

<span><b>
        TL;DR</b></span>
<p>
    Yet another hexo theme.
</p>
<hr />


<span><b>
        TL;DR 2</b></span>
<p>
    No, not another one :/
</p>
<hr />






<span><a href="https://twitter.com/hexojs" target="_blank" rel="noopener"><b><i class="fab fa-twitter-square"></i>
            <i class="fas fa-at"></i>
            hexojs</b></a></span>
<br />
<a class="twitter-timeline" data-height="800" data-dnt="true" data-chrome="nofooter transparent noheader noborders "
    href="https://twitter.com/hexojs?ref_src=twsrc%5Etfw"></a>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

        </div>
    </div>
</div>
<!-- Menu fade on scroll -->
<script>
    var isScrolling;
    var prevScrollpos = window.pageYOffset;
    window.addEventListener('scroll', function (event) {
        window.clearTimeout(isScrolling);
        isScrolling = setTimeout(function () {
            var currentScrollPos = window.pageYOffset;
            if (prevScrollpos > currentScrollPos) {
                $("#navbar").slideDown();
            } else {
                $("#navbar").slideUp();
            }
            prevScrollpos = currentScrollPos;
        }, 66);
    }, false);
</script>

<a class="float-left gradient btn paginationbtn" href="/2019/08/03/Androidç»„ä»¶åŒ–å¼€å‘/"><i class="fas fa-chevron-left"></i></a>


    </main>
    <!-- Footer -->
    <footer class="page-footer">
  <div class="container">
    <div class="social-icons">
      
      <a href="https://hexo.io/" title="Hexo.io" target="_blank" rel="noopener" class="fas fa-home"></a>
      
      <a href="https://twitter.com/hexojs" title="@hexojs" target="_blank" rel="noopener" class="fab fa-twitter"></a>
      
      <a href="https://github.com/RandomAdversary/Gradient/issues" title="Report issue" target="_blank" rel="noopener" class="fas fa-bug"></a>
      
    </div>
  </div>
</footer>
    <!-- After footer scripts -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
    crossorigin="anonymous"></script>
</body>

</html>